# libalioth 0.1 架构设计

> 作者 : 王雨泽 2019/01/22  
> 对应编译器版本 : aliothc 0.1  
> 对应语言版本 : Alioth 0.8

[TOC]

## 1. 职能概述

`libalioth`由`C++`编写而成,是用于实现`alioth`编程语言编译器的`SDK`.

`libalioth`在当前版本的主要功能是为`alioth`编程语言的编译过程提供前端及外围支持.

## 2. 执行流程概览

1. 编译器启动,`main`函数负责在此时处理入口参数  
   从入口参数判断用户意图,使用参数初始化顶层管理器$_{Manager}$实例

1. `Manager`初始化文档引擎$_{Dengine}$,日志引擎$_{Lengine}$,语义引擎$_{Sengine}$  
   各引擎从配置文件读取配置信息,装配资源

1. `Manager`受到调度,输入目标模块名称,执行一个构建任务,`Manager`开始分析模块依赖关系  
   闭包构建目标模块的依赖关系图,检查依赖错误.  
   此时若出现依赖错误,则使用日志引擎$_{Lengine}$管理依赖错误,并停止执行

1. `Manager`使用模块描述符$_{Modesc}$作为每个模块的占位符,在不分析全部源代码的情况下  
   描述模块的依赖关系图.分析依赖关系图,将得到一系列不重复的模块描述符,它们代表着本次构建  
   所需的模块,接下来`Manager`将控制权交给这些模块描述符

1. 模块描述符知悉描述本模块的所有源文档的所在位置,模块描述符会使用文档引擎$_{Dengine}$  
   读取源文档内容,经过词法分析$_{token::fromInputStream}$和语法分析$_{\sum stmt*::Create}$,建立语法树  
   过程中发现的词法或语法错误将被日志引擎$_{Lengine}$收纳.

1. 语义引擎$_{Sengine}$受到`Manager`调度,将各模块编译到`LLVM IR`以备使用LLVM产生目标代码
   
1. 最后将`LLVM`产生的目标代码由文档引擎写入目标输出流.

## 3.  模块划分及模块构成

### 3.1. 词法模块

词法模块包含以下职能.

提供一种方法,描述一种词法记号

提供一种方法,从字节输入流按照词法规则产生词法记号序列

词法模块将上述两种功能实现为`token`结构体,`token`结构体所携带的信息量足以描述一个词法记号的相关信息

`token`类提供了用于词法分析的静态函数.

